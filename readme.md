## The whisker tracking container 
The purpose of this repository is to provide a container to run [Janelia's whisker tracking software](https://journals.plos.org/ploscompbiol/article?id=10.1371/journal.pcbi.1002591) and Chris Rodgers's wrapping functions (WhiskiWrap). The code base is cloned from Ariel Iporre's Python3-updated repositories: 
https://github.com/aiporre/whisk
https://github.com/aiporre/WhiskiWrap  

## Example calls using WhiskiWrap
Basic tracing:   
```
docker run --rm -v $(pwd):/data -t whisk-ww \
python -c "import WhiskiWrap; WhiskiWrap.pipeline_trace('test.mp4', 'output.hdf5', n_trace_processes=12)"
```
`$(pwd)` stands for the current directory, assuming this is the data directory. On Windows, use `%cd%` from the Command Prompt, or `${PWD}` from PowerShell.  
More efficient tracing function (`interleaved_reading_and_tracing`).  
```
mkdir whiski_wrap_session`  
  
docker run --rm -v $(pwd):/data -t whisk-ww \
python -c "import WhiskiWrap; from WhiskiWrap import FFmpegReader; \
WhiskiWrap.interleaved_reading_and_tracing(FFmpegReader('/data/test.mp4'),'whiski_wrap_session', h5_filename='output.hdf5',n_trace_processes=20)"
```

The input video file can be any format that a default ffmpeg install can read. 

## Example calls using Janelia's whisker tracking code
In theory, the code can read 8-bit grayscale StreamPix (Norpix Sequence Format: SEQ), TIFF, MPEG, MOV, and AVI formatted video.
In practice, this is often not the case. For example, pre-built Windows binaries that used to be available [online](http://whiskertracking.janelia.org) could read .mp4 files. The compiled version here does not (at least not in my hands - if you know how to solve this, please get in touch). It can read tiff files, however, such as those generated by the wrapping functions. 

### run trace
`docker run -v <data directory>:/data -t whisk bash -c "trace <file name>.tif <file name>.whiskers"`  

If running directly from the data directory, you can change <data directory> by `%cd%` (Windows cmd), `${PWD}` (PowerShell), or `$(pwd)` (Linux). 
E.g.: `docker run -v $(pwd):/data -t whisk bash -c "trace <file name>.tif <file name>.whiskers"`

### run measure
`docker run -v <data directory>:/data -t whisk bash -c "measure --face <face_x_y> x <file name>.whiskers <file name>.measurements"`

### run classify
`docker run -v <data directory>:/data -t whisk bash -c "classify <file name>.measurements <file name>.measurements <face_x_y> x --px2mm <px/mm ratio> -n <num_whiskers> --limit2.0:50.0'"`

## Test the container
`docker run -t whisk bash -c "trace"` should return:  
```
trace: Too few required arguments  
Usage: trace <movie:string> <prefix:string>
```
